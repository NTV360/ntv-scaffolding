<div
  class="graph-container"
  [class.graph-small]="isSmall()"
  [class.graph-fullscreen]="isFullscreen()"
>
  @if (config().header || config().headerMetrics?.length) {
  <div class="graph-header">
    @if (showFilters()) {
    <div class="header-row">
      <div class="title-section">
        @if (config().header) {
        <div class="title">{{ config().header }}</div>
        } @if (config().subHeader) {
        <div class="sub-title">{{ config().subHeader }}</div>
        } @if (config().headerMetrics?.length) {
        <div class="metrics-row">
          @for (metric of config().headerMetrics; track metric.label) {
          <div class="metric-item">
            <span class="metric-label">{{ metric.label }}:</span>
            <span
              class="metric-value"
              [style.color]="metric.color || '#666666'"
            >
              {{ metric.value }}
            </span>
          </div>
          }
        </div>
        }
      </div>

      <div class="controls">
        <!-- Legend -->
        <div class="legend">
          @for (series of chartOptions().series!; track series.name) {
          <div class="legend-item">
            <span
              class="legend-marker"
              [style.background-color]="chartOptions().colors![$index]"
            ></span>
            <span class="legend-text">{{ series.name }}</span>
          </div>
          }
        </div>

        <!-- Filters -->
        <div class="filters">
          <!-- Month Dropdown -->
          <div class="custom-dropdown" #monthDropdown>
            <button
              class="dropdown-trigger"
              (click)="toggleMonthDropdown()"
              [class.active]="isMonthDropdownOpen()"
              type="button"
              aria-label="Select month"
            >
              <span class="dropdown-text">{{ getSelectedMonthLabel() }}</span>
              <svg
                class="dropdown-arrow"
                width="12"
                height="12"
                viewBox="0 0 12 12"
                fill="none"
                aria-hidden="true"
              >
                <path
                  d="M3.49976 7.92857L5.99976 10.4286L8.49976 7.92857"
                  stroke="#8DCB2C"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3.49976 3.64284L5.99976 1.14284L8.49976 3.64284"
                  stroke="#8DCB2C"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            @if (isMonthDropdownOpen()) {
            <div class="dropdown-menu">
              @for (month of filteredMonthlyTimeFrames(); track month.value) {
              <label class="dropdown-item">
                <input
                  type="checkbox"
                  [checked]="selectedMonth() === month.value"
                  (change)="onMonthCheckboxChange(month.value, $event)"
                  class="checkbox-input"
                />
                <span class="checkbox-custom"></span>
                <span class="item-label">{{ month.label }}</span>
              </label>
              }
            </div>
            }
          </div>

          <!-- Year Dropdown -->
          <div class="custom-dropdown" #yearDropdown>
            <button
              class="dropdown-trigger"
              (click)="toggleYearDropdown()"
              [class.active]="isYearDropdownOpen()"
              type="button"
              aria-label="Select year"
            >
              <span class="dropdown-text">{{ getSelectedYearLabel() }}</span>
              <svg
                class="dropdown-arrow"
                width="12"
                height="12"
                viewBox="0 0 12 12"
                fill="none"
                aria-hidden="true"
              >
                <path
                  d="M3.49976 7.92857L5.99976 10.4286L8.49976 7.92857"
                  stroke="#8DCB2C"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3.49976 3.64284L5.99976 1.14284L8.49976 3.64284"
                  stroke="#8DCB2C"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            @if (isYearDropdownOpen()) {
            <div class="dropdown-menu">
              @for (year of filteredYearlyTimeFrames(); track year.value) {
              <label class="dropdown-item">
                <input
                  type="checkbox"
                  [checked]="selectedYear() === year.value"
                  (change)="onYearCheckboxChange(year.value, $event)"
                  class="checkbox-input"
                />
                <span class="checkbox-custom"></span>
                <span class="item-label">{{ year.label }}</span>
              </label>
              }
            </div>
            }
          </div>

          <button
            class="switch-button"
            (click)="toggleChartType()"
            type="button"
            aria-label="Switch graph type"
          >
            <span class="button-text">Switch Graph</span>
          </button>
        </div>
      </div>
    </div>
    } @else {
    <div class="header-row">
      <div class="title-section">
        @if (config().header) {
        <div class="title">{{ config().header }}</div>
        } @if (config().subHeader) {
        <div class="sub-title">{{ config().subHeader }}</div>
        } @if (config().headerMetrics?.length) {
        <div class="metrics-row">
          @for (metric of config().headerMetrics; track metric.label) {
          <div class="metric-item">
            <span class="metric-label">{{ metric.label }}:</span>
            <span
              class="metric-value"
              [style.color]="metric.color || '#666666'"
            >
              {{ metric.value }}
            </span>
          </div>
          }
        </div>
        }
      </div>
      <div class="legend">
        @for (series of chartOptions().series!; track series.name) {
        <div class="legend-item">
          <span
            class="legend-marker"
            [style.background-color]="chartOptions().colors![$index]"
          ></span>
          <span class="legend-text">{{ series.name }}</span>
        </div>
        }
      </div>
    </div>
    }
  </div>
  }

  <div class="graph-content">
    <apx-chart
      #chart
      [series]="chartOptions().series!"
      [chart]="chartOptions().chart!"
      [xaxis]="chartOptions().xaxis!"
      [yaxis]="chartOptions().yaxis!"
      [grid]="chartOptions().grid!"
      [stroke]="chartOptions().stroke!"
      [markers]="chartOptions().markers!"
      [colors]="chartOptions().colors!"
      [legend]="{ show: false }"
      [tooltip]="chartOptions().tooltip!"
      [dataLabels]="chartOptions().dataLabels!"
      style="width: 100%; height: 100%"
    >
    </apx-chart>
  </div>
</div>
